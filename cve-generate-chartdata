#!/bin/bash

# Directory containing CVE summary JSON files
CVE_CHECK_DIR="cve_check"

# Output directory for CVE reports
OUTPUT_DIR="output"

# Path to cve-report.py script
CVE_REPORT_SCRIPT="./cve-report.py"

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Loop through each branch directory in cve_check
for branch_dir in "./$CVE_CHECK_DIR"/*; do
    branch_name=$(basename "$branch_dir")
    # Loop through each JSON file in the branch directory
    for json_file in "$branch_dir"/*.json; do
        # Generate CVE report for each JSON file
        "$CVE_REPORT_SCRIPT" "$json_file" > "$OUTPUT_DIR/cve-status-$branch_name.txt"
    done
    # Generate overall CVE report for the branch
    "$CVE_REPORT_SCRIPT" "$branch_dir"/*.json > "$OUTPUT_DIR/cve-report-$branch_name.txt"
done

echo "CVE reports generated successfully."

