<html>
<!--
SPDX-License-Identifier: MIT
-->
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.0/c3.min.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.0/c3.min.css" rel="stylesheet">
        <style>
            .c3-line {
                stroke-width: 2px;
            }
        </style>
    </head>
    <body>
        <h1>Current CVE status for meta-openembedded</h1>
        <ul>
        <li><a href="cve-status-master.txt">master</a></li>
        <li><a href="cve-status-nanbield.txt">nanbield</a></li>
        <li><a href="cve-status-mickledore.txt">mickledore</a></li>
        <li><a href="cve-status-langdale.txt">langdale</a></li>
        <li><a href="cve-status-kirkstone.txt">kirkstone</a></li>
        <li><a href="cve-status-dunfell.txt">dunfell</a></li>
        </ul>

        <h1>CVE Trends for meta-oe</h1>
        <div id="cve_chart"></div>

        <h1>Current Patch Status Pie</h1>
        <div id="status_pie_chart"></div>

        <h1>Patch Upstream-Status Counts (meta-openembedded)</h1>
        <div id="upstream_status_chart"></div>

        <h1>Patch Tag Error Counts (meta-openembedded)</h1>
        <div id="malformed_chart"></div>

        <h1>Recipe Count (meta-openembedded)</h1>
        <div id="recipe_count_chart"></div>

        <h2>Raw Data</h2>
        <ul>
        <li><a href="patch-status.json">patch-status.json</a></li>
        <li><a href="patch-status-pie.json">patch-status-pie.json</a></li>
        <li><a href="patch-status-byday.json">patch-status-byday.json</a></li>
        <li><a href="cve-count-byday.json">cve-count-byday.json</a></li>
        <li><a href="releases.csv">releases.csv</a></li>
        </ul>

        <script type="text/javascript">
            var valid_status = ['pending', 'backport', 'inappropriate', 'accepted', 'submitted', 'denied'];
            var label_names = {
                pending: "Pending",
                backport: "Backport",
                inappropriate: "Inappropriate",
                accepted: "Accepted",
                submitted: "Submitted",
                denied: "Denied",
                total: "Total",
                'malformed-sob': "Malformed Signed-off-by",
                'malformed-upstream-status': "Malformed Upstream-Status"
            };

            d3.json("patch-status-pie.json").then(function(data) {
                var chart = c3.generate({
                    bindto: '#status_pie_chart',
                    data: {
                        json: [data],
                        keys: {
                            value: valid_status
                        },
                        type: "pie",
                        names: label_names
                    },
                    pie: {
                        label: {
                            format: function (value, ratio, id) {
                                return d3.format('.0%')(ratio);
                            }
                        }
                    }
                });
            });

            d3.dsv(",", "releases.csv", function(d) {
                return {
                    value: new Date(d.Date),
                    text: d.Name
                };
            }).then(function(release_lines) {
                d3.json("cve-count-byday.json").then(function(cve_data) {
                    cve_data2 = []
                    for (var key in cve_data) {
                        cve_data[key].date = key
                        cve_data2.push(cve_data[key])
                    }

                    var chart = c3.generate({
                        bindto: '#cve_chart',
                        data: {
                            json: cve_data2,
                            xFormat: "%s",
                            keys: {
                                x: "date",
                                value: ['master', 'nanbield', 'mickledore', 'langdale', 'kirkstone', 'honister', 'hardknott', 'gatesgarth', 'dunfell']
                            },
                            type: "line",
                            names: label_names
                        },
                        axis: {
                            x: {
                                type: 'timeseries',
                                tick: {
                                    format: '%Y-%m-%d'
                                },
                                localtime: false
                            },
                            y: {
                                min: 0,
                                padding: {bottom:0}
                            }
                        },
                        grid: {
                            x: {
                                lines: release_lines
                            },
                            y: {
                                show: true
                            }
                        },
                        zoom: {
                            enabled: true
                        },
                        line: {
                            connectNull: true
                        },
                        point: {
                            show: false
                        }
                    });

                });

            });

            d3.dsv(",", "releases.csv", function(d) {
                return {
                    value: new Date(d.Date),
                    text: d.Name
                };
            }).then(function(release_lines) {
                d3.json("patch-status-byday.json").then(function(status_data) {
                    var chart = c3.generate({
                        bindto: '#upstream_status_chart',
                        data: {
                            json: status_data,
                            xFormat: "%s",
                            keys: {
                                x: "date",
                                value: valid_status.concat(['total'])
                            },
                            type: "area",
                            groups: [valid_status, ['total']],
                            names: label_names
                        },
                        axis: {
                            x: {
                                type: 'timeseries',
                                tick: {
                                    format: '%Y-%m-%d'
                                },
                                localtime: false
                            }
                        },
                        grid: {
                            x: {
                                lines: release_lines
                            },
                            y: {
                                show: true
                            }
                        },
                        zoom: {
                            enabled: true
                        },
                        point: {
                            show: false
                        }
                    });

                    var chart = c3.generate({
                        bindto: '#malformed_chart',
                        data: {
                            json: status_data,
                            xFormat: "%s",
                            keys: {
                                x: "date",
                                value: ['total', 'malformed-upstream-status', 'malformed-sob']
                            },
                            type: "area",
                            names: label_names
                        },
                        axis: {
                            x: {
                                type: 'timeseries',
                                tick: {
                                    format: '%Y-%m-%d'
                                },
                                localtime: false
                            }
                        },
                        grid: {
                            x: {
                                lines: release_lines
                            },
                            y: {
                                show: true
                            }
                        },
                        zoom: {
                            enabled: true
                        },
                        point: {
                            show: false
                        }
                    });
                    var chart = c3.generate({
                        bindto: '#recipe_count_chart',
                        data: {
                            json: status_data,
                            xFormat: "%s",
                            keys: {
                                x: "date",
                                value: ['recipe_count']
                            },
                            type: "area",
                            names: label_names
                        },
                        axis: {
                            x: {
                                type: 'timeseries',
                                tick: {
                                    format: '%Y-%m-%d'
                                },
                                localtime: false
                            }
                        },
                        grid: {
                            x: {
                                lines: release_lines
                            },
                            y: {
                                show: true
                            }
                        },
                        zoom: {
                            enabled: true
                        },
                        point: {
                            show: false
                        }
                    });

                });
            });
        </script>
    </body>
</html>
